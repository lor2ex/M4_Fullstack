### Сравнение 
#### - тестов репозитория, 
#### - эндпойнтов без реальной БД 
#### - и эндпойнтов с реальной БД

| Аспект                | Тест репозитория                     | Тест эндпоинтов без DB (mock)                        | Интеграционный тест эндпоинтов (`routes_db`)                           |
| --------------------- | ------------------------------------ | ---------------------------------------------------- | ---------------------------------------------------------------------- |
| Проверяемый уровень   | Бизнес-логика работы с DB напрямую   | HTTP-слой + вызовы репозитория (замокан)             | HTTP-слой + репозиторий + реальная DB                                  |
| FastAPI               | Нет                                  | Да, но все зависимости моканы                        | Да                                                                     |
| Асинхронность         | async/await SQLAlchemy               | async/await HTTP (эндпоинты)                         | async/await HTTP + SQLAlchemy                                          |
| Использование фикстур | `db_session`, `repository`           | `async_client`, `mock_session`, `mock_repo`          | `async_client_with_db`, `override_get_db`, `created_book`              |
| Мокинг                | Нет (реальная in-memory DB)          | Все операции репозитория и сессий замоканы           | Только реальные объекты, без моков                                     |
| Цель                  | Проверка CRUD репозитория в изоляции | Проверка логики эндпоинтов без базы (Unit-тест HTTP) | Проверка полного пути: запрос → репозиторий → DB (интеграционный тест) |
| Скорость              | Очень быстрая (in-memory DB)         | Очень быстрая (нет реальной DB)                      | Медленнее (работает реальная база)                                     |

**Ключевые моменты:**

1. **Тест репозитория**: 
   * проверяем чисто CRUD-операции SQLAlchemy, 
   * никакой HTTP-логики. 
   * Можно делать полностью awaitable через `db_session`.

2. **Эндпойнты без базы (mock)**: 
   * проверяем FastAPI-слой, в том числе зависимости (`get_session`) через моки. 
   * Здесь важно убедиться, что 
     * эндпойнт вызывает репозиторий корректно 
     * и возвращает нужный статус/ответ.

3. **Интеграционный тест эндпойнтов**: 
   * полный путь запроса через FastAPI 
   * к реальному репозиторию и in-memory базе. 
   * Проверяем, что **все слои вместе** работают как ожидается.


