# Переход Pydantic v1 → v2
## 1. Когда произошёл переход

Pydantic v2 был официально выпущен в **2023 году**.
Это был самый крупный и важный релиз за всю жизнь библиотеки.  
В настоящее время в v2 поддерживается совместимость с v1 через отдельный слой `pydantic.v1`,  
чтобы существующие проекты могли продолжать работать. 

И как долго будет продолжаться эта поддержка — неизвестно.

---

## 2. Почему понадобился переход

Основная причина — **недостатки внутренней архитектуры v1**, которые мешали:

* дальнейшему росту производительности;
* корректной и предсказуемой типизации;
* поддержанию библиотеки без накопления технического долга;
* использованию более строгих правил валидации.

Pydantic v1, написанный на Python с элементами C-оптимизации,  
стал стандартом де-факто в FastAPI и многих других проектах.  

По мере роста популярности стало очевидно: 
* библиотека подошла к пределу возможностей своего первоначального дизайна.

---

## 3. Почему изменение оказалось настолько глобальным?

### 3.1 Использование языка `Rust`

Ядро Pydantic v2 переписали с нуля на языке **Rust**.  

Rust — системный язык без сборщика мусора, ориентированный на:

* высокую скорость исполнения;
* безопасность работы с памятью;
* нулевую стоимость абстракций.

Программы на Rust по скорости сопоставимы с C/C++.  
Для Pydantic это означало качественный скачок.

### 3.2 Выигрыш в производительности

Благодаря переходу на Rust-ядро `pydantic-core`:

* валидация стала **в 5–50 раз быстрее**, в зависимости от структуры данных;
* сериализация ускорилась;
* нагрузка на CPU заметно снизилась;  
* уменьшилось количество ошибок и непредсказуемых ситуаций, характерных для Python-only реализации.

Такой скачок был невозможен в рамках архитектуры v1, поэтому пришлось переписывать систему полностью.

### 3.3 Новая модель валидаторов

* Новые правила валидации и сериализации стали гораздо более строгими и чёткими.  
* Это улучшило предсказуемость, но привело к несовместимости со старой моделью.  

Именно совокупность этих изменений сделала переход глобальным и затронула весь экосистему Python, включая FastAPI.

---

## 4. Минусы глобального перехода

### 4.1 Несовместимость с v1

Большинство валидаторов, настройки модели, старые поля и механики перестали работать “как есть”.

### 4.2 Необходимость миграции

Проекты на FastAPI, написанные за годы, потребовали:

* переписывания валидаторов,
* замены конфигураций,
* корректировки моделей.

### 4.3 Переход занял время у всей экосистемы

* Многие пакеты (в т.ч. FastAPI) должны были адаптироваться под v2.
* Часть библиотек на момент выхода v2 не была совместима.

Но разработчики решили, что это оправданная цена за долгосрочное развитие.

---

## 5. Как проверить, что ваш `pip install fastapi` использует Pydantic v2?

### Шаг 1 — проверить установленную версию Pydantic

```
pip show pydantic
```

Если версия **2.x.x → значит, используется v2.**

### Шаг 2 — проверить установленную версию FastAPI

```
pip show fastapi
```

Версии **0.119.0 и выше** официально поддерживают Pydantic v2.

### Шаг 3 — убедиться, что в коде не используются механизмы v1

* Нет `@validator`
* Нет `Config`
* Нет старых полей типа `Field(..., example=...)`

Если всё это отсутствует — проект работает в режиме Pydantic v2.

Если в установленном модуле Python есть папка `pydantic/v1/` — это слой совместимости,  
но он не означает, что проект на v1.  
Это просто обеспечение обратной совместимости для старых проектов.

---

## 6. Как быть в прошлых и будущих проектах?

### 6.1 Старые проекты

Есть два сценария:

#### ✔ Оставить проект на v1 через слой совместимости

Импорт выглядит так:

```
from pydantic.v1 import BaseModel
```

Этот подход хорош, если:

* проект стабилен,
* нет времени на миграцию,
* критично избежать изменений.

#### ✔ Постепенно мигрировать на v2

Постепенный переход подходит, если:

* проект развивается,
* важна производительность,
* хочется избавиться от устаревших конструкций.

Миграция выполняется поэтапно: обновляются модели, валидаторы, схемы.

---

### 6.2 Новые проекты

Однозначно следует использовать **только Pydantic v2**, так как:

* v1 больше не развивается;
* v2 быстрее и стабильнее;
* документация и новые фичи ориентированы на v2;
* экосистема движется в сторону v2.

---

### Итог

Переход Pydantic v1 → v2 стал одним из крупнейших изменений в Python-среде за последние годы:  
* он требовал серьёзных изменений, 
* но в результате дал мощный прирост производительности, предсказуемости и качества типизации. 

(Почти как переход Python2 → Python3)

Несмотря на затраты миграции, направление выбрано правильно,  
а FastAPI и современные проекты уже полностью опираются на Pydantic v2.

