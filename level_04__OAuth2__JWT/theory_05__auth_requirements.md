### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–í –Ω–∞—à–µ–º –∫–æ–¥–µ –æ–Ω–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –∑–¥–µ—Å—å:

```python
current_user: User = Depends(get_current_user)
```

–≠—Ç–æ –ø–æ—è–≤–ª—è–ª–æ—Å—å –≤ –∑–∞—â–∏—â—ë–Ω–Ω–æ–º —ç–Ω–¥–ø–æ–π–Ω—Ç–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```python
@app.get("/users/me")
async def read_users_me(current_user: User = Depends(get_current_user)):
    return current_user
```

---

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `Depends(get_current_user)`?

–í–æ—Ç –∫–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:

1. –ö–ª–∏–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ `/users/me`
2. FastAPI –≤–∏–¥–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `Depends(get_current_user)`
3. FastAPI **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç** `get_current_user`
4. –ê –≤ `get_current_user` –º—ã:

   * –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ `Authorization: Bearer <token>`
   * –¥–µ–∫–æ–¥–∏—Ä—É–µ–º JWT
   * –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—å
   * –≤–∞–ª–∏–¥–∏—Ä—É–µ–º —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏
   * –∏—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   * –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ–Ω –Ω–µ `disabled`

* –ï—Å–ª–∏ —Å —Ç–æ–∫–µ–Ω–æ–º –ø—Ä–æ–±–ª–µ–º—ã ("–Ω–µ—Ç", "–Ω–µ–≤–∞–ª–∏–¥–µ–Ω", "–ø—Ä–æ—Å—Ä–æ—á–µ–Ω", "–Ω–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å" –∏ —Ç.–¥.), —Ç–æ
* ‚Üí FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–µ—Ä–Ω—ë—Ç:

```json
{
  "detail": "Could not validate credentials"
}
```

–°–æ —Å—Ç–∞—Ç—É—Å–æ–º:

```
401 Unauthorized
```

---

### –ì–¥–µ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

```python
oauth2_scheme = OAuth2PasswordBearer(tokenUrl="token")
```

–≠—Ç–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:

* –∏—â–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>`
* –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥—ë—Ç ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ 401

---

### –ê –¥–∞–ª—å—à–µ –≤ `get_current_user`:

```python
token = oauth2_scheme(...)
payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
username = payload.get("sub")
```

–ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≤–∞–ª–∏—Ç—Å—è:

```python
raise HTTPException(
    status_code=status.HTTP_401_UNAUTHORIZED,
    detail="Could not validate credentials",
    headers={"WWW-Authenticate": "Bearer"},
)
```
---

### –†–µ–∑—é–º–µ

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤—Å–µ —ç–Ω–¥–ø–æ–π–Ω—Ç—ã, –≥–¥–µ –µ—Å—Ç—å `Depends(get_current_user)`, —Ç—Ä–µ–±—É—é—Ç JWT-—Ç–æ–∫–µ–Ω.

–í—Å–µ –Ω–∞—à–∏ —ç–Ω–¥–ø–æ–π–Ω—Ç—ã (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏ –±—É–¥—É—â–∏–µ) –º–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ 2 –≥—Ä—É–ø–ø—ã:

1. üîì –û—Ç–∫—Ä—ã—Ç—ã–µ (–Ω–µ —Ç—Ä–µ–±—É—é—Ç —Ç–æ–∫–µ–Ω)

* `/token`
* –ª—é–±—ã–µ –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–±–∞–≤–∏–º, –≥–¥–µ –ù–ï –±—É–¥–µ—Ç `current_user: User = Depends(get_current_user`

2. üîí –ó–∞—â–∏—â—ë–Ω–Ω—ã–µ (—Ç—Ä–µ–±—É—é—Ç —Ç–æ–∫–µ–Ω)

* `/users/me`
*  –ª—é–±—ã–µ –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–±–∞–≤–∏–º, –≥–¥–µ –±—É–¥–µ—Ç `current_user: User = Depends(get_current_user`

