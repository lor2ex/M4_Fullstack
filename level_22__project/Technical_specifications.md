# Project M4-2: AI-генератор постов для Telegram 

## 1. Введение

Вас взяли работать в стартап, который хочет автоматизировать новостной Telegram-канал на новом уровне.
 Ваша задача — сделать сервис, который не просто парсит новости, но использует ИИ для генерации ярких, лаконичных и интересных постов на основе собранных материалов.
 Публикация должна идти в Telegram-канал по расписанию, с возможностью ручного управления и мониторинга через API.

Вам предстоит интегрировать несколько сервисов: парсинг новостей (сайты и Telegram-каналы), очередь задач, генерацию постов с помощью AI (например, OpenAI GPT-4), публикацию через Telethon и реализацию панели управления источниками.

Срок выполнения — **одна неделя**. Вопросы — к ментору.



## 2. Функциональные блоки

### 1. Сбор и парсинг новостей (сайты и Telegram-каналы)

- Собирать новости не только с сайтов (Habr, РБК, VC, Tproger), но и из публичных Telegram-каналов (с помощью Telethon).
- Для каждого источника реализовать отдельный парсер.
- По расписанию запускать сбор новостей (каждые 30 минут, Celery Beat).
- Каждая новость должна содержать: `title`, `url` (если есть), `summary`, `source`, `published_at`.

**Темы:**

- Web scraping, Telethon (чтение сообщений)
- Асинхронность
- Celery Beat

------

### 2. Очередь задач и асинхронная обработка

- Использование **Celery** и брокера (**RabbitMQ** или Redis) для обработки задач (парсинг, генерация, публикация).
- Фоновая цепочка: парсинг → фильтрация → генерация поста через AI → публикация.
- Все тяжелые операции — в отдельных тасках Celery.

**Темы:**

- Celery (chains, groups)
- Redis/RabbitMQ как брокер

------

### 3. AI-генерация постов

- Использовать OpenAI GPT-4 или другую AI-модель через публичный API.
- На вход: текст новости/сводка/пост из Telegram, на выход: сгенерированный пост по заданному промпту.
- Настроить промпт: “Сделай краткое, интересное описание новости для Telegram-канала, добавь emoji, call to action”.
- Обработка ошибок API (rate limit, недоступность).
- Возможность вручную протестировать генерацию через API.

**Темы:**

- Интеграция внешнего API (OpenAI)
- Промпт-инжиниринг
- Асинхронные вызовы

------

### 4. Фильтрация и отбор релевантных новостей

- Перед генерацией AI фильтровать новости по ключевым словам, языку, источнику.
- Гибкая система фильтров (через настройки или API).
- Исключение дублей (смотреть по title/url/контенту).

**Темы:**

- Фильтрация, настройки
- Работа с текстом

------

### 5. Публикация в Telegram через Telethon

- После генерации AI-поста отправлять его в указанный Telegram-канал (через Telethon).
- Проверять, что пост не был уже опубликован.
- Логировать успешные публикации и ошибки.

**Темы:**

- Telegram API, Telethon
- Логирование

------

### 6. Управление источниками и ключевыми словами (панель администратора через API)

- REST API для добавления, редактирования, удаления источников новостей (сайты, Telegram-каналы).
- API для управления списком ключевых слов и фильтров.
- Эндпоинты для просмотра истории постов, логов ошибок.

**Темы:**

- FastAPI endpoints
- CRUD-операции
- Pydantic-схемы

------

### 7. Документация API (Swagger)

- Автоматическая генерация через FastAPI (`/docs`).
- Документировать основные эндпоинты: новости, генерация, публикация, источники, фильтры.



## 3. Структура данных

**Модель NewsItem:**

- `id` (uuid или hash)
- `title` (str)
- `url` (str, optional)
- `summary` (str)
- `source` (str)
- `published_at` (datetime)
- `raw_text` (str, если из Telegram)

**Модель Post:**

- `id`
- `news_id`
- `generated_text` (str)
- `published_at` (datetime)
- `status` (new/generated/published/failed)

**Модель Source:**

- `id`
- `type` (site/tg)
- `name`
- `url` (или username для TG)
- `enabled` (bool)

**Модель Keyword:**

- `id`
- `word`



## 4. Структура проекта

```
/aibot/
├── app/
│   ├── main.py
│   ├── api/
│   │   ├── endpoints.py
│   │   └── schemas.py
│   ├── news_parser/
│   │   ├── sites.py
│   │   └── telegram.py
│   ├── ai/
│   │   ├── openai_client.py
│   │   └── generator.py
│   ├── telegram/
│   │   ├── bot.py
│   │   └── publisher.py
│   ├── tasks.py
│   ├── models.py
│   ├── config.py
│   └── utils.py
├── celery_worker.py
├── requirements.txt
├── README.md
└── .env
```

## 5. Чеклист по функциональности

| №    | Функция                  | URL/Команда      | Методы | Технологии          |
| ---- | ------------------------ | ---------------- | ------ | ------------------- |
| 1    | Сбор новостей (сайты)    | Celery Beat      | -      | Celery, requests    |
| 2    | Сбор новостей (Telegram) | Celery Beat      | -      | Telethon            |
| 3    | Фильтрация новостей      | -                | -      | Python, Redis       |
| 4    | AI-генерация постов      | Celery Task      | -      | OpenAI API, asyncio |
| 5    | Публикация в Telegram    | Celery Task      | -      | Telethon, Redis     |
| 6    | API-управление           | `/api/sources/`  | CRUD   | FastAPI             |
| 7    | API-фильтры              | `/api/keywords/` | CRUD   | FastAPI             |
| 8    | История постов           | `/api/posts/`    | GET    | FastAPI             |
| 9    | Генерация вручную        | `/api/generate/` | POST   | FastAPI, OpenAI     |
| 10   | Документация API         | `/docs/`         | GET    | FastAPI (Swagger)   |
| 11   | Логирование              | -                | -      | logging             |



## 6. Критерии оценки (грейдинг)

| Критерий                                | Баллы   |
| --------------------------------------- | ------- |
| Сбор и хранение новостей                | 10      |
| Очереди задач, Celery, брокер           | 10      |
| Интеграция с Telegram (чтение/отправка) | 10      |
| AI-генерация постов                     | 20      |
| Фильтрация, настройка                   | 10      |
| Панель управления (API источников)      | 10      |
| FastAPI REST API, документация          | 10      |
| Логирование, история, структура         | 10      |
| README, инструкция, аккуратность        | 10      |
| **Максимум**                            | **100** |

Минимальный проходной балл — 65.



## 7. Требования к сдаче

1. **GitHub-репозиторий** с полным кодом проекта.
2. **README.md** с описанием, структурой, инструкцией по запуску, примером API-запросов.
3. (По желанию) — docker-compose файл, скринкаст работы или демонстрационный Telegram-канал.
4. Ссылка на репозиторий + ФИО и учебную группу прислать преподавателю.
5. **Чек-лист** с отметками по реализации (можно приложить отдельно).



## 8. Рекомендации по процессу

- Работайте по этапам (см. roadmap), не делайте всё в один заход.
- Регулярно тестируйте интеграции: API OpenAI, Telethon, Celery.
- Все настройки — в `.env` или `config.py`, API-ключи нигде не светите!
- Пишите README и requirements.txt сразу, чтобы не забыть.
- Если застряли — обращайтесь за помощью к ментору или группе.


## 9. План работы по этапам (roadmap)

1. **Инициализация**: структура проекта, requirements, .env, запуск FastAPI.
2. **Парсер новостей**: реализовать сбор с сайтов и Telegram-каналов, сохранять новости.
3. **Celery + брокер**: настроить очереди, сделать цепочки задач: парсинг → AI-генерация → публикация.
4. **Фильтрация**: добавить фильтр по ключевым словам, настройку фильтров.
5. **AI-генерация**: интеграция OpenAI, настройка промпта, обработка ошибок, ручная генерация.
6. **Публикация**: отправка сгенерированных постов в Telegram через Telethon.
7. **API**: реализовать эндпоинты для управления источниками, фильтрами, историей постов.
8. **Документация**: Swagger, описание API, инструкции в README.
9. **Финальный этап**: самопроверка по чек-листу, ревизия кода, сдача.



## 10. Дедлайн

Сдать проект до **[дата X]** (одна неделя от даты старта).
 Удачи!

